---
title: "Optogenetically Induced Descending Inhibition"
author: "Anastasia Lysenko"
output: 
  html_document:
    theme: cerulean
    code_folding: hide
    toc: true
    toc_float: true
---

<script type="text/javascript">
 function showhide(id) {
    var e = document.getElementById(id);
    e.style.display = (e.style.display == 'block') ? 'none' : 'block';
 }
 
 function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
 }
</script>

```{r, include=FALSE}
library(mosaic)
library(car)
library(pander)
library(DT) 
library(tidyverse)
library(dplyr)
library(plotly)




cell1 <-read_csv("../Data/Project - Cell1.csv")
cell2 <- read_csv("../Data/Project - Cell2.csv")
cell3 <- read_csv("../Data/Project - Cell3.csv")
cell4 <- read_csv("../Data/Project - Cell4.csv")
cell5 <- read_csv("../Data/Project - Cell5.csv")


CombineExc <- read_csv("../Data/Project - CombineExcitatory.csv")
CombineExcR <-filter(CombineExc, !is.na(Ra))
  group_by(CombineExcR,Stimulation_Type, Cell) %>%
  summarise(min = min(Ra), Q1 = quantile(Ra, 0.25), med = median(Ra), Q3 = quantile(Ra, 0.75), max = max(Ra), Mean=mean(Ra), sigma = sd(Ra)) %>%
pander()
  
  
 Sheet9 <- read_csv("../Data/Project - Sheet9.csv") 
  
 

```

## Background {.tabset .tabset-fade}

### Overview

Pain serves an important biological function. It acts as a system that helps us survive. It tells us when we need to rest and recover, what places and activities to avoid, and ultimately is a very powerful biological driving force for behavior. Some pain, however, does not serve those purposes, and, in fact, has the opposite, detrimental, effect on our health. Pain that persists after the wound has healed, or chronic pain, serves no purpose and is extremely distressing and destructive for those who suffer from it[^1]. Chronic pain is a growing public health concern[^2] [^3] and, yet, adequate treatment options are lacking[^4] [^5]. A decent understanding of the neuronal basis on pain circuitry is essential for coming up with effective treatment of such idiopathic pains.

Recently, we have been discovering more and more about the way these types of pain work. Scientists have made enormous strides to understanding the areas of the brain that process this type of pain, but the exact mechanisms that control this interaction remain unknown. In order for medications and interventions to be produced to counteract it, the mechanisms must be understood on a very detailed level. 

The area of the brain that specifically has been shown to manage this pain is called RVM (rostral ventromedial medulla)[^6]. RVM does this by communicating with neurons in the spinal cord that transmit pain information to our brain. It has been shown that RVM has an inhibitory effect on the spinal cord neurons[^7] [^8], but the exact mechanisms and cell to cell connectivity patterns remains a mystery[^9]. Our project seeks to better understand these connections by using state of the art techniques to record the exact ways these cells are communicating (click on the "Experimental Details" tab for more information).


### Experimental Details


Refer to the picture below to see an overall experimental desigh of the study:


<br/>
<center>
<img src="../Data/ExperimentDetails.png" style="width:1000px;border:2px white;border-radius:5px;">
</center>
<br/>


Click on the "Original Data" tab to see the data with the results from the above experiment.



### Original Data {.tabset}

These results come from adult mouse#2 which had 50 nl of ChR2 and YFP-producing viruses injected for 8 weeks. Axon Instruments electrophysiological equipment was used to record lamina I neuron cells' responses from the Lumbar (L1–6) area of the spinal cord in the whole-cell mode. Optogenetic techniques (both monochromator and laser) were applied for the activation of RVM descending axons. 5 cells were successfully patched and had the data recorded on them. 

'Order': order in which the data was recorded.

'FileName': the name of the file where the data was taken from.

'Trace_Number': every protocol of stimulation is recorded multiple times. Trace# (different sweeps on a graph) denotes each of those times. With the existing protocol, the first sweep was without any optogenetic stimulation for an additional control.

'Ra': Access Resistance and is measured in $M\Omega$ - resistance between electrodes and the inside environment of the cell, or, in other words, the sum of the pipette resistance and the residual resistance of the ruptured patch.
Note, when the laser was used Ra is unknown due to a current lack of instructions for finding it when using the laser in the design of the existing protocol.  


'Stimulation_Type': denotes what type of stimulation was performed for a particular data piece. There were three different types:

1. "control" - when only the electrical stimulation of the dorsal root was performed.

2. "monochromator" - when both electrical stimulations of the dorsal root and optogenetic stimulation of RVM descending fibers using 480nm 5Hz 5ms monochromator were performed.

3. "laser" - when both electrical stimulations of the dorsal root and optogenetic stimulation of RVM descending fibers using 5Hz 1ms laser were performed.

'Total_Area': integral of the overall response curve which is proportional to total charge transfer through the membrane and is measure in $pA*ms$. For excitatory responses values are negative because the current was directed into the opposite direction; for inhibitory responses the values are positive.

'First_Peak': the amplitude of the first peak of the cell's response and is measured in $pA$. For excitatory responses values are negative because the current was directed into the opposite direction; for inhibitory responses the values are positive.



#### Cell 1


```{r}
datatable(cell1)
```

#### Cell 2

```{r}
datatable(cell2)
```

#### Cell 3

```{r}
datatable(cell3)
```

#### Cell 4

```{r}
datatable(cell4)
```


#### Cell 5

```{r}
datatable(cell5)
```



## Analysis

To better understand the connectivity patterns of the RVM descending axons with the lamina I neurons of the spinal cord, we will first need to know if we have stimulated the RVM axons. To know that, we will need to compare if we get different responses from the patched cell when we use light stimulation (monochromator or laser) and when we don't (control). If we see that the responses from either "laser" or "monochromator" are different than from the "control" group, this would tell us that we have activated something other than just the dorsal root neurons, which most likely is the RVM descending axons since we are activating the area where those axons reside (although we would need to do futher checking if we are only activating ChR2 in the RVM axons and nothing else with the negative control). So below are the results of the One-way ANOVA test checking if we get different responses in at least one group for the first 3 cells (note, both "monochromator" and "laser" were used only on the first 3 cells. The last two cells only had "monochromator" and "control" used as 'Stimulation_Types'). 

<div style="font-size:0.8em;">Note: The data can only be compared if the Ra (acess resistence) is approximately the same between the compared data chunks. Thus, if you click on 'Show how the data was filtered' tab under each cell, you will see the way that rule was implemented and achieved for each of the cells.</div>

### Two Experimental Groups vs Control {.tabset .tabset-fade}

Since we are interested in knowing if there is a difference in the response of the spinal cord cells after electrical stimulation of dorsal root with and without simultaneous RVM axons stimulation by light our null and alternative hypotheses for all 3 cells are as follows: 


$$
  H_0: \mu_{control} = \mu_{laser} = \mu_{monochromator}  = \mu
$$
$$
  H_a: \mu_i \neq \mu \ \text{for at least one}\ i\in\text{ `Stimulation_Type`}
$$


The level of significance is set at $\alpha$ = 0.05 for this study.


If we reject the null, that would mean that at least one of the optogenetic methods is working and is activating the descending axons of RVM (or something other than just dorsal root neurons). If we fail to reject the null, that would mean that none of the experimental groups are working. 


#### Cell 1 

Since the First Peak of Cell1 is not monosynaptic, we are going to only compare values of Total_Area of the cell’s response after the stimulations.

<a href="javascript:showhide('datatable')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatable" style="display:none;">

Since we can only compare those portions of the data where the Ra is approximately the same for all of the data points, all of the Ra values for each 'Stimulation_Type' were compared and filtered to achieve that rule using 20% as a cut off (or maximum percentage) of Ra deviation. Even though we do not know the exact values of Ra when the laser was used (the white spaces in the plot below), chances are it follows a line connecting the monochromator results or the control right at the beginning or at the end where laser stimulation was performed. So, for this portion of the analysis, I used the very last connecting data points as the maximum or the minimum Ra of the laser (assuming laser Ra did not go pass those minimum and maximum values) to have at least some insight into if the laser, monochromator, and control groups produce different responses. Because the exact Ra's of the laser was not known, we will have to take the results of the laser group with a grain of salt. However, still, most likely the data was filtered correctly and the results are valid. 

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra withing the 20% difference and was used for getting the ANOVA test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out. 

Note, you can hover over the dots and see the exact values of Ra and Total Area.

```{r message=FALSE, warning=FALSE}
plot_ly(cell1,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(list(type='line', x0= 11, x1= 11, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 36, x1= 36, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 54, x1= 54, y0=0, y1=50, line=list(dash='dot', width=2)),
                        
                        
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 0, x1 = 11, xref = "x",
                    y0 = 0, y1 = 50, yref = "y"),
                   list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 36, x1 =54, xref = "x",
                    y0 = 0, y1 = 50, yref = "y")),
       title = "Change in Ra since time in Cell1",
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```


Below is the five-number summary of the region of the graph that is not highlighted in grey taking the very last Ra of control and monochromator as the ending/starting points of the laser Ra:

```{r}
cell1Filterlm<-filter(cell1, (Order > 11 & Order< 37) | (Order > 53 ))
pander(favstats(cell1Filterlm$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 12-36 and 54-85", split.table=Inf)
```


If we assume that the largest Ra value for the laser is 37.42 the difference between min and max Ra is 19.0% (<20%), which means we can proceed with comparing the three groups for these segments of the data.

----


</div>


  
**Total Area Response:**

Below is the boxplot comparison between all the three groups for the filtered chunk of data (click 'Show how the data was filtered' for more details on this):

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell1Filterlm, col=c("skyblue","yellow","orange"), main = "Lamina I Cell1 Inhibitory Currents Comparison in mouse#2", xlab =" Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```

```{r}
 cell1Filterlm %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell1 with the Ra difference within 20%", split.table=Inf)
```


<a href="javascript:showhide('qqplot')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplot" style="display:none;">


Before performing the One-way ANOVA test, let's first see if the requirements for this test are satisfied:

```{r}
cell1aov<-aov(Total_Area~Stimulation_Type, data = cell1Filterlm)
par(mfrow = c(1,2))
plot(cell1aov, which = 1)
qqPlot(cell1aov$residuals, id=FALSE, main = "Normal Q-Q", ylab = "Stansardized residuals", xlab = "Theoretical Quantiles")
```

Since the requirements are fairly satisfied, we can proceed with the One-way ANOVA test. Below are the results:


</div>



```{r, include=FALSE}
cell1aov<-aov(Total_Area~Stimulation_Type, data = cell1Filterlm)
pander(summary(cell1aov), split.table=Inf)
```



|       &nbsp;         | Df |   Sum Sq    |  Mean Sq   | F value  |  Pr(>F)  |
|:----------------------: |---- |-----------| ----------- |---------| ----------|
| **Stimulation_Type** |  2 |   256878906  | 128439453  |  19.38  |  4.53e-07 |
|   **Residuals**  |     54 |  357899212  |  6627763  |   &nbsp;  |    &nbsp;  |

Table: Analysis of Variance Model of Total_Area Cell1 of 'laser', 'control', 'monochromator'


Since p-value < $\alpha$ (4.53e-07<0.05), we reject the null and conclude that at least one of the means of all three groups is different, and, thus, one of the Stimulation Types (either monochromator or laser, or both) is working.





----

From the above results, we see that consistently at least one of the optogenetic methods (monochromator or laser) is working. While "monochromator" works the same way in all 3 cells inhibiting both the excitatory and inhibitory currents, "laser" seems to not give consistent results. To further confirm on which one of the two methods is activating RVM axons consistently and how the responses of a cell change, we will have to perform the Independent Samples t-Test on each experimental group separately. 

----




#### Cell 2 

Since the First Peak of Cell2 is monosynaptic, we are going to compare both the Total_Area and the First_Peak amplitude of the cell's response after the stimulations. 

<a href="javascript:showhide('datatable1')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatable1" style="display:none;">

Since we can only compare those portions of the data where the Ra is approximately the same for all of the data points, all of the Ra values for each 'Stimulation_Type' were compared and filtered to achieve that rule using 20% as a cut off (or maximum percentage) of Ra deviation. Even though we do not know the exact values of Ra when the laser was used (the white spaces in the plot below), chances are it follows the curved line connecting the control results at the beginning and at the end where laser stimulation was performed. So, for this portion of the analysis, I used the very last connecting data points as the maximum and the minimum Ra of the laser (assuming laser Ra did not go pass those minimum and maximum values) to have at least some insight into if the laser, monochromator, and control groups produce different responses. Because the exact Ra's of the laser was not known, we will have to take the results of the laser group with a grain of salt. However, still, most likely the data was filtered correctly and the results are valid. 

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra withing the 20% difference and was used for getting the ANOVA test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out. 

Note, you can hover over the dots and see the exact values of Ra and Total Area.

```{r message=FALSE, warning=FALSE}
plot_ly(cell2,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area, "\n", "First_Peak:", First_Peak), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(list(type='line', x0= 32, x1= 32, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 71, x1= 71, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 0, x1= 101, y0= 36.859333, y1=  36.859333, line=list(dash='line', width=1, color = "red")),
                        list(type='line', x0= 31, x1= 31, y0=0, y1=50, line=list(dash='line', width=1, color = "red")),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 =71, x1 = 101, xref = "x",
                    y0 = 0, y1 = 50, yref = "y"),
                    list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 =0, x1 = 32, xref = "x",
                    y0 = 0, y1 = 50, yref = "y")),
       title = 'Change in Ra since time in Cell2',
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```


```{r}
cell2Filterlm<-filter(cell2, Order > 31 & Order < 72)
```


If we take Order = 71 as an ending point, then the maximum Ra for this data chunk is 44.23 and the start point has to be no greater than 36.859333 for the Ra difference to be at 20%. If we draw a horizontal line in red at 36.859333 and vertical line through it where we would imagine the line of the Ra to go if laser's Ra was known, we will get the Order = 31 as the starting point. To be sure, that the data is less than 20%, we will not include the starting point itself. So, assuming that this data segment ('Order' is 32-71) has Ra within 20% difference we will proceed with the test. 

----

</div>



<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'FirstPeakResponselmc')">First Peak Response</button>
  <button class="tablinks" onclick="openTab(event, 'TotalAreaResponselmc')">Total Area Response</button>
</div>

<div id="FirstPeakResponselmc" class="tabcontent" style="display:block;">
  <p>
  
  


**First Peak Response:**

Below is the boxplot comparison between all the three groups for the filtered chunk of data (click 'Show how the data was filtered' for more details on this):
  
```{r}
boxplot(First_Peak~Stimulation_Type, data = cell2Filterlm, col=c("skyblue","yellow","orange"), main = "Lamina I Cell2 Excitatory Currents Comparison in mouse#2", xlab = " Stimulation Type of RVM Descending Fibers", ylab="First Peak of Monosynaptic Response (pA)")
```

```{r}
cell2Filterlm %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample size'=n()) %>% pander(caption="Summary Statistics of First_Peak Cell2 With the Ra Difference Within 20%", split.table=Inf)
```



<a href="javascript:showhide('qqplot2')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplot2" style="display:none;">


Before performing the One-way ANOVA test, let's first see if the requirements for this test are satisfied:



```{r}
cell2aov1<-aov(First_Peak~Stimulation_Type, data = cell2Filterlm)
par(mfrow = c(1,2))
plot(cell2aov1, which = 1)
qqPlot(cell2aov1$residuals, id=FALSE, main = "Normal Q-Q", ylab = "Stansardized residuals", xlab = "Theoretical Quantiles")
```


Since the requirements are fairly satisfied, we can proceed with the One-way ANOVA test. Below are the results:


</div>



```{r, include=FALSE}
cell2aov1<-aov(First_Peak~Stimulation_Type, data = cell2Filterlm)
pander(summary(cell2aov1), split.table=Inf)
```
  


|       &nbsp;         | Df |   Sum Sq    |  Mean Sq   | F value  |  Pr(>F)  |
|:----------------------: |---- |-----------| ----------- |---------| ----------|
| **Stimulation_Type** |  2 |  19780  | 9890   |  23.94 | 2.132e-07  |
|   **Residuals**  |     37 |  15285  |  413.1 |   &nbsp;  |    &nbsp;  |

Table: Analysis of Variance Model of Total_Area Cell2 of 'laser', 'control', 'monochromator'


Since p-value < $\alpha$ (2.132e-07<0.05), we reject the null and conclude that at least one of the means of all three groups is different, and, thus, one of the Stimulation Types (either monochromator or laser, or both) is working.

   
  </p>
</div>



<div id="TotalAreaResponselmc" class="tabcontent" style="display:block;">
  <p>


 
  **Total Area Response:**
  
Below is the boxplot comparison between all the three groups for the filtered chunk of data (click 'Show how the data was filtered' for more details on this):

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell2Filterlm, col=c("skyblue","yellow","orange"), main = "Lamina I Cell2 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```

```{r}
cell2Filterlm %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell2 With the Ra Difference Within 20%", split.table=Inf)
```


<a href="javascript:showhide('qqplot3')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplot3" style="display:none;">


Before performing the One-way ANOVA test, let's first see if the requirements for this test are satisfied:


```{r}
cell2aov2<-aov(Total_Area~Stimulation_Type, data = cell2Filterlm)
par(mfrow = c(1,2))
plot(cell2aov2, which = 1)
qqPlot(cell2aov2$residuals, id=FALSE, main = "Normal Q-Q", ylab = "Stansardized residuals", xlab = "Theoretical Quantiles")
```


Since the requirements are fairly satisfied, we can proceed with the One-way ANOVA test. Below are the results:


</div>



```{r, include=FALSE}
cell2aov2<-aov(Total_Area~Stimulation_Type, data = cell2Filterlm)
pander(summary(cell2aov2), split.table=Inf)
```

|       &nbsp;         | Df |   Sum Sq    |  Mean Sq   | F value  |  Pr(>F)  |
|:----------------------: |---- |-----------| ----------- |---------| ----------|
| **Stimulation_Type** |  2 |   1785982 | 892991  |  6.987  |  0.002665 |
|   **Residuals**  |     37 | 4728758  |  127804  |   &nbsp;  |    &nbsp;  |

Table: Analysis of Variance Model of Total_Area Cell2 of 'laser', 'control', 'monochromator'

Since p-value < $\alpha$ (0.002665<0.05), we reject the null and conclude that at least one of the means of all three groups is different, and, thus, one of the Stimulation Types (either monochromator or laser, or both) is working.


 </p>
</div>



----

From the above results, we see that consistently at least one of the optogenetic methods (monochromator or laser) is working. While "monochromator" works the same way in all 3 cells inhibiting both the excitatory and inhibitory currents, "laser" seems to not give consistent results. To further confirm on which one of the two methods is activating RVM axons consistently and how the responses of a cell change, we will have to perform the Independent Samples t-Test on each experimental group separately. 

----


 
#### Cell 3 

Since the First Peak of Cell3 is monosynaptic, we are going to compare both the Total_Area and the First_Peak amplitude of the cell's response after the stimulations. 

<a href="javascript:showhide('data')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="data" style="display:none;">


Since we can only compare those portions of the data where the Ra is approximately the same for all of the data points, all of the Ra values for each 'Stimulation_Type' were compared and filtered to achieve that rule using 20% as a cut off (or maximum percentage) of Ra deviation. Even though we do not know the exact values of Ra when the laser was used (the white spaces in the plot below), chances are it follows the curved line connecting the control results at the beginning and at the end where laser stimulation was performed. So, for this portion of the analysis, I used the very last connecting data points as the maximum and the minimum Ra of the laser (assuming laser Ra did not go pass those minimum and maximum values) to have at least some insight into if the laser, monochromator, and control groups produce different responses. Because the exact Ra's of the laser was not known, we will have to take the results of the laser group with a grain of salt. However, still, most likely the data was filtered correctly and the results are valid. 

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra withing the 20% difference and was used for getting the ANOVA test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out. 

Note, you can hover over the dots and see the exact values of Ra and Total Area.


```{r message=FALSE, warning=FALSE}
plot_ly(cell3,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area, "\n", "First_Peak:", First_Peak), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(
                        list(type='line', x0= 33, x1= 33, y0=0, y1=62, line=list(dash='dot', width=2)),
                        list(type='line', x0= 64, x1= 64, y0=0, y1=62, line=list(dash='dot', width=2)),
                         list(type='line', x0= 81, x1= 81, y0=0, y1=62, line=list(dash='dot', width=2)),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 64, x1 = 81, xref = "x",
                    y0 = 0, y1 = 62, yref = "y"),
                    list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 0, x1 = 33, xref = "x",
                    y0 = 0, y1 = 62, yref = "y")),
       title = 'Change in Ra since time in Cell3',
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```


Below is the five-number summary of the region of the graph that is not highlighted in grey taking the very last Ra of control as the ending and starting points of the laser Ra:



```{r}
cell3Filterlm<-filter(cell3, (Order > 32 & Order < 65) | (Order > 81))
pander(favstats(cell3Filterlm$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 33-64 and 81-93", split.table=Inf)
```

From here we can see that the difference between the minimum and maximum values of Ra is 17.6% (<20%), which means we can proceed with comparing the three groups for these segments of the data.

----

</div>





<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'FirstPeakResponselmc22')">First Peak Response</button>
  <button class="tablinks" onclick="openTab(event, 'TotalAreaResponselmc22')">Total Area Response</button>
</div>

<div id="FirstPeakResponselmc22" class="tabcontent" style="display:block;">
  <p>
  
  


**First Peak Response:**
  
Below is the boxplot comparison between all the three groups for the filtered chunk of data (click 'Show how the data was filtered' for more details on this):

```{r}
boxplot(First_Peak~Stimulation_Type, data = cell3Filterlm, col=c("skyblue","yellow","orange"), main = "Lamina I Cell3 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="First Peak of Monosynaptic Response (pA)")
```

```{r}
cell3Filterlm %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample size'=n()) %>% pander(caption="Summary Statistics of First_Peak Cell3 With the Ra Difference Within 20%", split.table=Inf)
```


<a href="javascript:showhide('qqplotb')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplotb" style="display:none;">



Before performing the One-way ANOVA test, let's first see if the requirements for this test are satisfied:


```{r}
cell3aov<-aov(First_Peak~Stimulation_Type, data = cell3Filterlm)
par(mfrow = c(1,2))
plot(cell3aov, which = 1)
qqPlot(cell3aov$residuals, id=FALSE, main = "Normal Q-Q", ylab = "Stansardized residuals", xlab = "Theoretical Quantiles")
```

The requirements are not satisfied (in the 'Normal Q-Q' plot the data points are coming outside of the boundaries of the dashed lines), we will have to use Permutations Test (which allows for any test whether the data is parametric or not). Here are the results that we get:


```{r}
cell3aov<-aov(First_Peak~Stimulation_Type, data = cell3Filterlm)
observedTestStat <- summary(cell3aov)[[1]]$`F value`[1]

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell3Filterlm$First_Peak)
  permutedTest <- aov(permutedData ~ Stimulation_Type, data = cell3Filterlm)
  permutedTestStats[i] <- summary(permutedTest)[[1]]$`F value`[1]
}

hist(permutedTestStats, col = "skyblue", xlim = c(0,20))
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
sum(permutedTestStats >= observedTestStat)/N
```

</div>



```{r, include=FALSE}
cell3aov<-aov(First_Peak~Stimulation_Type, data = cell3Filterlm)
pander(summary(cell3aov), split.table=Inf)
```

|  F value  |  Pr(>F)  | Number of Iterations |
|:---------:| ---------|-------|
|   16.21   |     0    | 2000  |


Table: Permutation Test of First_Peak Cell3 of 'laser', 'control', 'monochromator'

Since p-value < $\alpha$ (0<0.05), we reject the null and conclude that at least one of the means of all three groups is different, and, thus, one of the Stimulation Types (either monochromator or laser, or both) is working.



  </p>
</div>



<div id="TotalAreaResponselmc22" class="tabcontent" style="display:block;">
  <p>




  **Total Area Response:**

 Below is the boxplot comparison between all the three groups for the filtered chunk of data (click 'Show how the data was filtered' for more details on this):


```{r}
boxplot(Total_Area~Stimulation_Type, data = cell3Filterlm, col=c("skyblue","yellow","orange"), main = "Lamina I Cell3 Excitatory Currents Comparison in mouse#2", xlab =" Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```

```{r}
cell3Filterlm %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell3 With the Ra Difference Within 20%", split.table=Inf)
```


<a href="javascript:showhide('qqplot5')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplot5" style="display:none;">


Before performing the One-way ANOVA test, let's first see if the requirements for this test are satisfied:


```{r}
cell3aov<-aov(Total_Area~Stimulation_Type, data = cell3Filterlm)
par(mfrow = c(1,2))
plot(cell3aov, which = 1)
qqPlot(cell3aov$residuals, id=FALSE, main = "Normal Q-Q", ylab = "Stansardized residuals", xlab = "Theoretical Quantiles")

```


Since the requirements are fairly satisfied, we can proceed with the One-way ANOVA test. Below are the results:


</div>


```{r, include=FALSE}
cell3aov<-aov(Total_Area~Stimulation_Type, data = cell3Filterlm)
pander(summary(cell3aov), split.table=Inf)
```


|       &nbsp;         | Df |   Sum Sq    |  Mean Sq   | F value  |  Pr(>F)  |
|:----------------------: |---- |-----------| ----------- |---------| ----------|
| **Stimulation_Type** |  2 |    9160244 | 4580122  |  23.34  | 1.707e-07 |
|   **Residuals**  |     41 | 8045137  |  196223 |   &nbsp;  |    &nbsp;  |

Table: Analysis of Variance Model of Total_Area Cell3 of 'laser', 'control', 'monochromator'

Since p-value < $\alpha$ (1.707e-07<0.05), we reject the null and conclude that at least one of the means of all three groups is different, and, thus, one of the Stimulation Types (either monochromator or laser, or both) is working.


</p>
</div>



----

From the above results, we see that consistently at least one of the optogenetic methods (monochromator or laser) is working. While "monochromator" works the same way in all 3 cells inhibiting both the excitatory and inhibitory currents, "laser" seems to not give consistent results. To further confirm on which one of the two methods is activating RVM axons consistently and how the responses of a cell change, we will have to perform the Independent Samples t-Test on each experimental group separately. 

----



### One Experimental group vs Control {.tabset .tabset-pills .tabset-fade}



#### Monochromator vs Control {.tabset .tabset-fade}


Since we are interested in knowing if there is a difference in the response of the spinal cord cells after electrical stimulation of dorsal root with and without simultaneous RVM axons stimulation by the monochromator, our null and alternative hypotheses for all 5 cells are as follows:

$$
  H_0: \mu_{control} = \mu_{monochromator}
$$

$$ 
  H_a: \mu_{control} \neq \mu_{monochromator}
$$
where,

$\mu_{control}$ is the mean Total_Area (in $pA*ms$)/First_Peak (in $pA$) of the patched cell's response after the axons of RVM were electrically stimulated (in pA*ms); 

$\mu_{monochromator}$ is the mean Total_Area (in $pA*ms$)/First_Peak (in $pA$) of the patched cell's response after the axons of RVM were simultaneously stimulated electrically and with a monochromator.

The level of significance is set at $\alpha$ = 0.05 for this study.


##### Cell 1

Since the First Peak of Cell1 is not monosynaptic, we are going to only compare values of Total_Area of the cell’s response after the stimulations.


```{r, include=FALSE}
cell1 <- read_csv("../Data/Project - Cell1.csv")
```

<a href="javascript:showhide('datatable4')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatable4" style="display:none;">

Since in this portion of the analysis we are only interested in comparing the responses of the cell when there was "monochromator" type stimulation versus when there was "control", we will have to compare only those portions of the data where the Ra of "monochromator" data is within 20% difference with the "control" type stimulation. 

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra within the 20% difference and was used for getting the Independent Samples t-Test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out. Also, since the Ra for the laser was not known, there are white spaces where the laser was used for stimulation. Note, you can also hover over the dots and see the exact values of Ra and Total Areas.


```{r message=FALSE, warning=FALSE}
plot_ly(cell1,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(list(type='line', x0= 24, x1= 24, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 61, x1= 61, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 24, x1 = 61, xref = "x",
                    y0 = 0, y1 = 50, yref = "y")),
       title = "Change in Ra since time in Cell1",
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```


Below is the five-number summary of the region of the graph that is not highlighted in grey:

```{r}
cell1Filter<-filter(cell1, Order < 24 | Order> 61)
pander(favstats(cell1Filter$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 1-23 & 62-85", split.table=Inf)
```



From here we can see that the difference between the minimum and maximum values of Ra is 22.0% (>20%). Thus, I decided to split the data in half with the following two *Data Segments*:

*1)* 'Order' 1-23

```{r}
cell1Filter1<-filter(cell1, Order < 24)
pander(favstats(cell1Filter1$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 1-23", split.table=Inf)
```


The difference between min and max Ra is 11.6% (<20%), which means we can proceed with comparing "monochromator" and "control" for this segment of data.


*2)* 'Order' 62-85

```{r}
cell1Filter2<-filter(cell1, Order >61)
pander(favstats(cell1Filter2$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 62-85", split.table=Inf)
```


The difference between min and max Ra is 5.5% (<20%), which means we can proceed with comparing "monochromator" and "control" for this segment of data.

----

</div>



**Total Area Response:**


*First Data Segment:*

Below is the boxplot comparison of the *First Data Segment* [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell1 for the 'Total_Area' column.

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell1Filter1, col=c("skyblue","orange"), main = "Lamina I Cell1 Inhibitory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell1Filter1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), sd =sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell1 First Data Segment", split.table=Inf)
```



<a href="javascript:showhide('qqplotcell1')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplotcell1" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell1Filter1$Total_Area[cell1Filter1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell1Filter1$Total_Area[cell1Filter1$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)
```


The 'Total_Area' when monochromator was stimulating the cell is normally distributed without a question. However, since the size of the control group is small (n=11), and the fact that one data point is outside of the normality boundaries, there is a question about the normality of the control group, so we will use Permutation Test (which allows for any test whether the data is parametric or not). Here are the results that we get:

```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell1Filter1, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell1Filter1$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell1Filter1, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats >= observedTestStat)/N
```


</div>


```{r include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell1Filter1), split.table=Inf)
```



|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|-------|------------------------|------------------------|
|   3.251     |      0.004    | 2000  |  two.sided       | 



Table: Permutation Test of Total_Area Cell1 First Data Segment of ‘control’ and ‘monochromator’ 



P-value is significant (0.004<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that when the axons of RVM are stimulated with monochromator the overall cell's response is different from that when there is no light stimulation.

From this data segment, we can conclude that, on average, monochromator decreases the Total_Area cell's response values from 18069 to 14650 which is **18.9%**.


*Second Data Segment:*


Below is the boxplot comparison of the *Second Data Segment* [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell1 for the 'Total_Area' column.

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell1Filter2, col=c("skyblue","orange"), main = "Lamina I Cell1 Inhibitory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell1Filter2 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample Size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell1 Second Data Segment", split.table=Inf)
```


<a href="javascript:showhide('qqplotcell12')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplotcell12" style="display:none;">

Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell1Filter2$Total_Area[cell1Filter2$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell1Filter2$Total_Area[cell1Filter2$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)
```

All the requirements are perfectly satisfied, so we can proceed with the Independent Samples t-Test. Below are the results:



</div>



```{r, include = FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell1Filter2), split.table=Inf)
```



| Test statistic |   df   |    P value  |    Alternative hypothesis |
|:----------------:|-------|--------------|------------------------|
|    7.678      |   21.66  |  1.287e-07 * * *   | two.sided      | 


Table: Welch Two Sample t-test: Total_Area Cell1 Second Data Segment of ‘control’ and ‘monochromator’


P-value is significant (1.287e-07<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that when the axons of RVM are stimulated with monochromator the overall cell’s response is different from that when there is no light stimulation.

From this data segment, we can conclude that, on average, monochromator decreases the Total_Area cell’s response values from 20300 to 14452 which is **28.8%**.



##### Cell 2

Since the First Peak of Cell2 is monosynaptic, we are going to compare both the Total_Area and the First_Peak amplitude of the cell's response after the stimulation. 

```{r message=FALSE, warning=FALSE, include = FALSE}
cell2 <- read_csv("../Data/Project - Cell2.csv")
```


<a href="javascript:showhide('datatable3')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatable3" style="display:none;">

Since in this portion of the analysis we are only interested in comparing the responses of the cell when there was "monochromator" type stimulation versus when there was "control", we will have to compare only those portions of the data where the Ra of "monochromator" data is within 20% difference with the "control" type stimulation. 

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra within the 20% difference and was used for getting the Independent Samples t-Test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out. Also, since the Ra for the laser was not known, there are white spaces where the laser was used for stimulation. Note, you can also hover over the dots and see the exact values of Ra, First_Peak, and Total_Area.


```{r message=FALSE, warning=FALSE}
plot_ly(cell2,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area, "\n", "First_Peak:", First_Peak), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(list(type='line', x0= 42, x1= 42, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 71, x1= 71, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 0, x1 = 42, xref = "x",
                    y0 = 0, y1 = 50, yref = "y")),
       title = 'Change in Ra since time in Cell2',
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```




Below is the five-number summary of the region of the graph that is not highlighted in grey:

```{r}
cell2Filter<-filter(cell2, Order > 41)
pander(favstats(cell2Filter$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 42-100", split.table=Inf)
```



From here we can see that the difference between the minimum and maximum values of Ra is 21.3% (>20%). Thus, I decided to split the data in half with the following two *Data Segments*:

*1)* 'Order' 42-71 

```{r}
cell2Filter1<-filter(cell2, Order > 41 & Order <= 71)
pander(favstats(cell2Filter1$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 42-71", split.table=Inf)
```


The difference between min and max Ra is 10.8% (<20%), which means we can proceed with comparing "monochromator" and "control" for this data segment.



*2)* 'Order' 72-100

```{r}
cell2Filter2<-filter(cell1, Order >71)
pander(favstats(cell2Filter2$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 72-100", split.table=Inf)
```



The difference between min and max Ra is 3.7% (<20%), which means we can proceed with comparing "monochromator" and "control" for this data segment.


----



</div>




<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'FirstPeakResponse')">First Peak Response</button>
  <button class="tablinks" onclick="openTab(event, 'TotalAreaResponse')">Total Area Response</button>
</div>

<div id="FirstPeakResponse" class="tabcontent" style="display:block;">
  <p>
  
  
  **First Peak Response:**


*First Data Segment:*

Below is the boxplot comparison of the *First Data Segment* [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell2 for the 'First_Peak' column.


```{r}
boxplot(First_Peak~Stimulation_Type, data = cell2Filter1, col=c("skyblue","orange"), main = "Lamina I Cell2 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="First Peak of Mosynaptic Response (pA)")
```


```{r}
cell2Filter1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample size'=n()) %>% pander(caption="Summary Statistics of First_Peak Cell2 First Data Segment", split.table=Inf)
```


<a href="javascript:showhide('qqplotcell2')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplotcell2" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:

Approprietness of the above test:

```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell2Filter1$First_Peak[cell2Filter1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="First_Peak", id=FALSE)
qqPlot(cell2Filter1$First_Peak[cell2Filter1$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="First_Peak", id=FALSE)
```



Since the size of the monochromator group is small (n=10), and the fact that one data point is outside of the normality boundaries, there is a question about the normality of the monochromator group, so we will use Permutation Test (which allows for any test whether the data is parametric or not). Here are the results that we get:


```{r}
myTest<-t.test(First_Peak~Stimulation_Type, data = cell2Filter1, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell2Filter1$Stimulation_Type)
  permutedTest <- t.test(First_Peak ~ permutedData, data = cell2Filter1, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue", xlim = c(-8,8))
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>


```{r, include=FALSE}
pander(t.test(First_Peak~Stimulation_Type, data = cell2Filter1), split.table=Inf)
```




|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|-------|------------------------|------------------------|
|    -5.916     |    0    | 2000  |  two.sided       | 






Table: Permutation Test of First_Peak Cell2 First Data Segment of ‘control’ and ‘monochromator’


P-value is very significant (0<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that when the axons of RVM are stimulated with monochromator the overall cell’s response is different from that when there is no light stimulation.

From this data segment, we can conclude that, on average, in the excitatory cell monochromator decreases the negative response from -221.5 to -174.8 which is **21.1%**.




*Second Data Segment:*


Below is the boxplot comparison of the second half of the data gathered in Cell2 for the 'Total_Area' column. The gray color indicates a non-significance of the p-value for the below boxplots.

```{r}
cell2Filter2<-filter(cell2, Order > 71)
boxplot(First_Peak~Stimulation_Type, data = cell2Filter2, col=c("gray58","gray82"), main = "Lamina I Cell2 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="First Peak of Monosynaptic Response (pA)")
```


```{r}
cell2Filter2 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample Size'=n()) %>% pander(caption="Summary Statistics of First_Peak Cell2 Second Data Segment", split.table=Inf)
```


<a href="javascript:showhide('qq')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qq" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:

```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell2Filter2$First_Peak[cell2Filter2$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="First_Peak", id=FALSE)
qqPlot(cell2Filter2$First_Peak[cell2Filter2$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="First_Peak", id=FALSE)
```

The requirements are satisfied, so we can proceed with the Independent Samples t-Test. Below are the results:

</div>


```{r, include=FALSE}
pander(t.test(First_Peak~Stimulation_Type, data = cell2Filter2), split.table=Inf)
```



| Test statistic |   df   |    P value  |    Alternative hypothesis |
|:----------------:|-------|--------------|------------------------|
|      -1.087      |   19.94 |  0.2899    |  two.sided       | 


Table: Welch Two Sample t-test: First_Peak Cell2 Second Data Segment of ‘control’ and ‘monochromator’



P-value is not significant (0.2899>$\alpha$), so we fail to reject the null. This means that there is no significant evidence to conclude that monochromator changes the overall cell’s response.



From this data segment, on average, in the excitatory cell monochromator decreased the negative response from -187.9 to -175.8 which is **6.4%**.
  
  </p>
</div>


<div id="TotalAreaResponse" class="tabcontent" style="display:block;">
  <p>

**Total Area Response:**

*First Data Segment:*

Below is the boxplot comparison of the first half of the data gathered in Cell2 for the 'Total_Area' column.


```{r}
boxplot(Total_Area~Stimulation_Type, data = cell2Filter1, col=c("skyblue","orange"), main = "Lamina I Cell2 Excitatory  Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell2Filter1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'Sample Size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell2 First Data Segment", split.table=Inf)
```


<a href="javascript:showhide('qqp')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqp" style="display:none;">


Before performing the Independent Samples t-Test, let’s first see if the requirements for this test are satisfied:

```{r}

par(mfrow=c(1,2))
qqPlot(cell2Filter1$Total_Area[cell2Filter1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell2Filter1$Total_Area[cell2Filter1$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)

```

Since the size of the monochromator group is small (n=10), and the fact that one data point is outside of the normality boundaries, there is a question about the normality of the monochromator group, so we will use Permutation Test (which allows for any test whether the data is parametric or not). Here are the results that we get:

```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell2Filter1, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell2Filter1$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell2Filter1, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>


```{r, include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell2Filter1), split.table=Inf)
```




| Test statistic |   df   |    P value  |    Alternative hypothesis |
|:----------------:|-------|--------------|------------------------|
|  -3.881      |   13.99 |  0.001   |  two.sided       | 



Table: Permutation Test of Total_Area Cell2 First Data Segment of ‘control’ and ‘monochromator’ 
 


P-value is significant (0.001<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that monochromator changes the overall cell's response.

From this data segment, we can conclude that, on average, monochromator decreases the Total_Area cell's response from -2598 to -2081 which is **19.9%**.


*Second Data Segment:*


Below is the boxplot comparison of the *Second Data Segment* [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell2 for the 'Total_Area' column.


```{r}
boxplot(Total_Area~Stimulation_Type, data = cell2Filter2, col=c("skyblue","orange"), main = "Lamina I Cell2 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell2Filter2 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell2 Second Data Segment", split.table=Inf)
```

<a href="javascript:showhide('qqplo')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="qqplo" style="display:none;">

Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:

```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell2Filter2$Total_Area[cell2Filter2$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell2Filter2$Total_Area[cell2Filter2$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)
```

The 'Total_Area' when monochromator was stimulating the cell is normally distributed without a question. However, since the size of the control group is relatively small (n=19), and the fact that a couple of data point is outside of the normality boundaries, there is a question about the normality of the control group, so we will use Permutation Test (which allows for any test whether the data is parametric or not). Here are the results that we get:


```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell2Filter2, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell2Filter2$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell2Filter2, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>


```{r, include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell2Filter2), split.table=Inf)
```



| Test statistic |   df   |    P value  |    Alternative hypothesis |
|:----------------:|-------|--------------|------------------------|
|  -2.263       |   22.6 |   0.027  |  two.sided       | 


Table: Permutation Test of Total_Area Cell2 Second Data Segment of ‘control’ and ‘monochromator’



P-value is significant ( 0.027<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that monochromator changes the overall cell's response.

From this data segment, we can conclude that, on average, monochromator decreases the Total_Area cell's response from -2209 to -1923 which is **12.9%**.




 </p>
</div>





##### Cell 3


Since the First Peak of Cell3 is monosynaptic, we are going to compare both the Total_Area and the First_Peak amplitude of the cell's response after the stimulation. 


```{r message=FALSE, warning=FALSE, include = FALSE}
cell3 <- read_csv("../Data/Project - Cell3.csv")
```

<a href="javascript:showhide('datatablecell')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatablecell" style="display:none;">


Since in this portion of the analysis we are only interested in comparing the responses of the cell when there was “monochromator” type stimulation versus when there was “control”, we will have to compare only those portions of the data where the Ra of “monochromator” data is within 20% difference with the “control” type stimulation.

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra within the 20% difference and was used for getting the Independent Samples t-Test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out. Also, since the Ra for the laser was not known, there are white spaces where the laser was used for stimulation. Note, you can also hover over the dots and see the exact values of Ra, First_Peak, and Total_Area.



```{r message=FALSE, warning=FALSE}
plot_ly(cell3,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area, "\n", "First_Peak:", First_Peak), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(list(type='line', x0= 9, x1= 9, y0=0, y1=62, line=list(dash='dot', width=2)),
                        list(type='line', x0= 32, x1= 32, y0=0, y1=62, line=list(dash='dot', width=2)),
                        list(type='line', x0= 64, x1= 64, y0=0, y1=62, line=list(dash='dot', width=2)),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 32, x1 = 64, xref = "x",
                    y0 = 0, y1 = 62, yref = "y"),
                    list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 0, x1 = 9, xref = "x",
                    y0 = 0, y1 = 62, yref = "y")),
       title = 'Change in Ra since time in Cell3',
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```




Below is the five-number summary of the region of the graph that that has 'Order' of 0-39 & 64-93:

```{r}
cell3Filter<-filter(cell3, Order < 40 | Order > 63)
pander(favstats(cell3Filter$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 0-39 & 64-93", split.table=Inf)
```



From here we can see that the difference between the minimum and maximum values of Ra is 64.6% (>20%). Thus, I decided to filter the data further with the following two *Data Segments*:

*1)* 'Order' 9-32 



Let's filter and see if min and max are <20% different from each other:

```{r}
cell3Filter1<-filter(cell3, Order >8 & Order <33)
pander(favstats(cell3Filter1$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 9-32", split.table=Inf)
```

The difference between min and max Ra is 19.6%, which means we can proceed with comparing “monochromator” and “control” for this data segment.

*2)* 'Order' 64-93

```{r}
cell3Filter2<-filter(cell2, Order > 63)
pander(favstats(cell3Filter2$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 64-93", split.table=Inf)
```


The difference between min and max Ra is 11.4%, which means we can proceed with comparing “monochromator” and “control” for this data segment.

----



</div>




<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'FirstPeakResponse14')">First Peak Response</button>
  <button class="tablinks" onclick="openTab(event, 'TotalAreaResponse14')">Total Area Response</button>
</div>

<div id="FirstPeakResponse14" class="tabcontent" style="display:block;">
  <p>
  


**First Peak Response:**


*First Data Segment:*


Below is the boxplot comparison of the First Data Segment [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell3 for the ‘First_Peak’ column. The gray color indicates a non-significance of the p-value for the below boxplots.

```{r}
boxplot(First_Peak~Stimulation_Type, data = cell3Filter1,  col=c("gray58","gray82"), main = "Lamina I Cell3 Excitatory Currents Comparison in mouse#2", xlab =" Stimulation Type of RVM Descending Fibers", ylab="First Peak of Mosynaptic Response (pA)")
```

```{r}
cell3Filter1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample Size'=n()) %>% pander(caption="Summary Statistics of First_Peak Cell3 First Data Segment", split.table=Inf)
```


<a href="javascript:showhide('third')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="third" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell3Filter1$First_Peak[cell3Filter1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="First_Peak", id=FALSE)
qqPlot(cell3Filter1$First_Peak[cell3Filter1$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="First_Peak", id=FALSE)
```


The control group seems to satisfy the requirements, however, the monochromator group does not, so we cannot proceed with performing the Independent Samples t-Test. So, instead, we are going to use Permutation Test (which allows for any test whether it is parametric or not). Here are the results that we get:

```{r}
myTest<-t.test(First_Peak~Stimulation_Type, data = cell3Filter1, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell3Filter1$Stimulation_Type)
  permutedTest <- t.test(First_Peak ~ permutedData, data = cell3Filter1, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>


```{r, include=FALSE}
pander(t.test(First_Peak~Stimulation_Type, data = cell3Filter1), split.table=Inf)
```




|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------------|------------------------|------------------------|
|    -1.851     |    0.082     | 2000  |  two.sided       | 


Table: Permutation Test of First_Peak Cell3 First Data Segment of ‘control’ and ‘monochromator’ 



P-value is not significant (0.082<$\alpha$), so we fail to reject the null. This means that there is no significant evidence to conclude that the monochromator changes the overall cell’s response.

From this data segment, on average, in the excitatory cell monochromator decreased the negative response from -112.9 to -95.23 which is **15.7%**.

*Second Data Segment:*


Below is the boxplot comparison of the Second Data Segment [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell3 for the ‘First_Peak’ column. The gray color indicates a non-significance of the p-value for the below boxplots.

```{r}
boxplot(First_Peak~Stimulation_Type, data = cell3Filter2, col=c("gray58","gray82"), main = "Lamina I Cell3 Excitatory Currents Comparison in mouse#2", xlab =" Stimulation Type of RVM Descending Fibers", ylab="First Peak of Mosynaptic Response (pA)")
```


```{r}
cell3Filter2 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'Sample Size'=n()) %>% pander(caption="
Summary Statistics of First_Peak Cell3 Second Data Segment", split.table=Inf)
```



<a href="javascript:showhide('datagh')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="datagh" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell3Filter2$First_Peak[cell3Filter2$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="First_Peak", id=FALSE)
qqPlot(cell3Filter2$First_Peak[cell3Filter2$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="First_Peak", id=FALSE)
```


The requirements are not satisfied, so we will use Permutation Test (which allows for any test whether the data is parametric or not). Here are the results that we get:


```{r}
myTest<-t.test(First_Peak~Stimulation_Type, data = cell3Filter2, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell3Filter2$Stimulation_Type)
  permutedTest <- t.test(First_Peak ~ permutedData, data = cell3Filter2, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>



```{r, include=FALSE}
pander(t.test(First_Peak~Stimulation_Type, data = cell3Filter2), split.table=Inf)
```



|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ----------------|------------------------|------------------------|
|    -1.179       |    0.247      | 2000  |  two.sided       | 


Table: Permutation Test of First_Peak Cell3 Second Data Segment of ‘control’ and ‘monochromator’ 


P-value is not significant ( 0.247<$\alpha$), so we fail to reject the null. This means that there is no significant evidence to conclude that the monochromator changes the overall cell’s response.


From this data segment, on average, in the excitatory cell monochromator decreased the negative response from -187.9 to -177.2 which is **5.7%**.


</p>
</div>


<div id="TotalAreaResponse14" class="tabcontent" style="display:block;">
  <p>



**Total Area Response:**


*First Data Segment:*

Below is the boxplot comparison of the First Data Segment [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell3 for the ‘Total_Area’ column. The gray color indicates a non-significance of the p-value for the below boxplots.

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell3Filter1,  col=c("skyblue","orange"), main = "Lamina I Cell3 Excitatory   Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```

```{r}
cell3Filter1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample Size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell3 First Data Segment", split.table=Inf)
```


<a href="javascript:showhide('dataaa')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="dataaa" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:

```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell3Filter1$Total_Area[cell3Filter1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell3Filter1$Total_Area[cell3Filter1$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)
```


The 'Total_Area' when monochromator was stimulating the cell is normally distributed without a question. However, since the size of the control group is small (n=15), and the fact that some of the data points are outside of the normality boundaries, there is a question about the normality of the control group, so we will use Permutation Test (which allows for any test whether the data is parametric or not). Here are the results that we get:

```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell3Filter1, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell3Filter1$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell3Filter1, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>


```{r, include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell3Filter1), split.table=Inf)
```



|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|------------------------|------------------------|
|    -3.724       |   0.002        | 2000  |  two.sided       | 


Table: Permutation Test of Total_Area Cell3 First Data Segment of ‘control’ and ‘monochromator’ 


P-value is very significant (0.002<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that monochromator changes the overall cell’s response.

From this data segment, we can conclude that, on average, in the excitatory cell monochromator decreases the negative response from -2451 to -1683 which is **31.3%**.


*Second Data Segment:*

Below is the boxplot comparison of the Second Data Segment [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell3 for the ‘Total_Area’ column. The gray color indicates a non-significance of the p-value for the below boxplots.

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell3Filter2,  col=c("gray58","gray82"), main = "Lamina I Cell3 Excitatory  Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```



```{r}
cell3Filter2 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell3 Second Data Segment", split.table=Inf)
```


<a href="javascript:showhide('table50')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="table50" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:

```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell3Filter2$Total_Area[cell3Filter2$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell3Filter2$Total_Area[cell3Filter2$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)
```

The requirements are not satisfied, so we cannot proceed with performing the Independent Samples t-Test. So, instead, we are going to use Permutations Test (which allows for any test whether it is parametric or not). Here are the results that we get:


```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell3Filter2, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell3Filter2$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell3Filter2, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>


```{r, include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell3Filter2), split.table=Inf)
```



|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|------------------------|------------------------|
|    -1.69        |  0.099       | 2000  |  two.sided       | 


Table: Permutation Test of Total_Area Cell3 Second Data Segment of ‘control’ and ‘monochromator’ 


P-value is not significant ( 0.099>$\alpha$), so we fail to reject the null. This means that there is no significant evidence to conclude that the monochromator changes the overall cell’s response.

From this data segment, on average, in the excitatory cell monochromator decreased the negative response from -2209 to  -2015 which is **8.8%**.


 </p>
</div>





##### Cell 4

Since the First Peak of Cell4 is monosynaptic, we are going to compare both the Total_Area and the First_Peak amplitude of the cell’s response after the stimulation.

```{r message=FALSE, warning=FALSE, include = FALSE}
cell4 <- read_csv("../Data/Project - Cell4.csv")
```


<a href="javascript:showhide('datatable5')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatable5" style="display:none;">


Since in this data set there were no "laser" recordings, in the graph below the area that is colored in grey indicates that the Ra was too low in comparison with the rest of the data, so this region of the data was not considered for this Analysis to achieve relatively the same Resistance across all the data points. The data was also split into sections to achieve a 20% rule in Ra (the vertical dashed lines indicate the exact place where the data was split). Note, you can also hover over the dots and see the exact values of Ra, First Peaks, and Total Areas.


```{r message=FALSE, warning=FALSE}
plot_ly(cell4,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area, "\n", "First_Peak:", First_Peak), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(list(type='line', x0= 10, x1= 10, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 45, x1= 45, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 0, x1 =10, xref = "x",
                    y0 = 0, y1 = 50, yref = "y")),
       title = 'Change in Ra since time in Cell4',
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```




Below is the five-number summary of the graph above:

```{r}
pander(favstats(cell4$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 1-86", split.table=Inf)
```


From here we can see that the difference between the minimum and maximum values of Ra is 79.5% (>20%). Thus, I decided to split the data in half with the following two *Data Segments*:

*1)* 'Order' 10-44

```{r}
cell4Filter1<-filter(cell4, Order<=44 & Order > 9)
pander(favstats(cell4Filter1$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 10-44", split.table=Inf)
```



The difference between min and max Ra is 17.4% (<20%), which means we can proceed with comparing “monochromator” and “control” for this data segment.


*2)* 'Order' 45-86

```{r}
cell4Filter2<-filter(cell4, Order>44 )
pander(favstats(cell4Filter2$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 45-86", split.table=Inf)
```



The difference between min and max Ra is 10.2% (<20%), which means we can proceed with comparing “monochromator” and “control” for this data segment.


----



</div>




<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'FirstPeakResponse4')">First Peak Response</button>
  <button class="tablinks" onclick="openTab(event, 'TotalAreaResponse4')">Total Area Response</button>
</div>

<div id="FirstPeakResponse4" class="tabcontent" style="display:block;">
  <p>
  
  
  **First Peak Response:**
  
 
 *First Data Segment:*

Below is the boxplot comparison of the *First Data Segment* [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell4 for the ‘First_Peak’ column. The gray color indicates a non-significance of the p-value for the below boxplots.

```{r}
boxplot(First_Peak~Stimulation_Type, data = cell4Filter1, col=c("gray58","gray82"), main = "Lamina I Cell4 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="First Peak of Mosynaptic Response (pA)")
```


```{r}
cell4Filter1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample size'=n()) %>% pander(caption="Summary Statistics of First Peak Amplitude Cell4 First Data Segment", split.table=Inf)
```


<a href="javascript:showhide('doit')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="doit" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell4Filter1$First_Peak[cell4Filter1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="First_Peak", id=FALSE)
qqPlot(cell4Filter1$First_Peak[cell4Filter1$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="First_Peak", id=FALSE)
```

All the requirements are perfectly satisfied, so we can proceed with the Independent Samples t-Test. Below are the results:


</div>



```{r, include=FALSE}
pander(t.test(First_Peak~Stimulation_Type, data = cell4Filter1), split.table=Inf)
```




| Test statistic |   df   |    P value  |    Alternative hypothesis |
|:----------------:|-------|--------------|------------------------|
|   -1.247      |  23.39 |    0.2249  |  two.sided       | 



Table: Welch Two Sample t-test: First_Peak Cell4 First Data Segment of ‘control’ and ‘monochromator’ 


P-value is not significant (0.2899>$\alpha$), so we fail to reject the null. This means that there is no significant evidence to conclude that the monochromator changes the overall cell’s response.

From this data segment, on average, in the excitatory cell monochromator inhibited the negative response from -154.2 to -138.1 which is **10.4%**.


*Second Data Segment:*


Below is the boxplot comparison of the *Second Data Segment* [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell4 for the ‘First_Peak’ column.

```{r}
boxplot(First_Peak~Stimulation_Type, data = cell4Filter2, col=c("skyblue","orange"), main = "Lamina I Cell4 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="First Peak of Monosynaptic Response (pA)")
```


```{r}
cell4Filter2 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample Size'=n()) %>% pander(caption="
Summary Statistics of First Peak Amplitude Cell4 Second Data Segment", split.table=Inf)
```



<a href="javascript:showhide('datalasts')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="datalasts" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell4Filter2$First_Peak[cell4Filter2$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="First_Peak", id=FALSE)
qqPlot(cell4Filter2$First_Peak[cell4Filter2$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="First_Peak", id=FALSE)
```


There is a question about the normality of the control group, so we are going to use Permutation Test (which allows for any test whether it is parametric or not). Here are the results that we get:

```{r}
myTest<-t.test(First_Peak~Stimulation_Type, data = cell4Filter2, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell4Filter2$Stimulation_Type)
  permutedTest <- t.test(First_Peak ~ permutedData, data = cell4Filter2, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```

</div>


```{r, include=FALSE}
pander(t.test(First_Peak~Stimulation_Type, data = cell4Filter2), split.table=Inf)
```


|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|------------------------|------------------------|
|    -2.098         |  0.037      | 2000  |  two.sided       | 


Table: Permutation Test of First_Peak Cell4 Second Data Segment of ‘control’ and ‘monochromator’ 


P-value is significant (0.037<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that monochromator changes the overall cell’s response.

From this data segment, we can conclude that, on average, monochromator decreases the First_Peak cell’s response from -146.5 to -124.6 which is **14.9%**.

  
  
  </p>
</div>


<div id="TotalAreaResponse4" class="tabcontent" style="display:block;">
  <p>

**Total Area Response:**


*First Data Segment:*

Below is the boxplot comparison of the First Data Segment [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell4 for the ‘Total_Area’ column. 


```{r}
boxplot(Total_Area~Stimulation_Type, data = cell4Filter1, col=c("skyblue","orange"), main = "Lamina I Cell4 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell4Filter1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample Size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell4 First Data Segment", split.table=Inf)
```

<a href="javascript:showhide('abovedd')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="abovedd" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell4Filter1$Total_Area[cell4Filter1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell4Filter1$Total_Area[cell4Filter1$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)
```


There is a question about the normality of the control group, so we are going to use Permutation Test (which allows for any test whether it is parametric or not). Here are the results that we get:


```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell4Filter1, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell4Filter1$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell4Filter1, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>




```{r, include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell4Filter1), split.table=Inf)
```



|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|------------------------|------------------------|
|    -2.276       |   0.027      | 2000  |  two.sided       | 


Table: Permutation Test of Total_Area Cell4 First Data Segment of ‘control’ and ‘monochromator’ 


P-value is significant (0.027<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that when the axons of RVM are stimulated with monochromator the overall cell's response is different.

From this data segment, on average, in the excitatory cell monochromator inhibited the negative response from -2043 to -1730 which is **15.3%**.


*Second Data Segment:*


Below is the boxplot comparison of the *Second Data Segment* [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell4 for the ‘Total_Area’ column.

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell4Filter2, col=c("skyblue","orange"), main = "Lamina I Cell4 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell4Filter2 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell4 Second Data Segment", split.table=Inf)
```


<a href="javascript:showhide('ghghg')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="ghghg" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell4Filter2$Total_Area[cell4Filter2$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell4Filter2$Total_Area[cell4Filter2$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)
```

The requirements seem to be satisfied, so we can proceed with the Independent Samples t-Test. Here are the results that we get:


</div>


```{r, include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell4Filter2), split.table=Inf)
```


| Test statistic |   df   |    P value  |    Alternative hypothesis |
|:----------------:|-------|--------------|------------------------|
|   -3.637      |   31.81 |    0.000966 * * * |  two.sided       | 



Table: Welch Two Sample t-test: Total_Area Cell4 Second Data Segment of ‘control’ and ‘monochromator’

P-value is significant (0.000966<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that when the axons of RVM are stimulated with monochromator the overall cell's response is different.

From this data segment, on average, in the excitatory cell monochromator inhibited the negative response from -2022 to -1617 which is **20.0%**.



 </p>
</div>




##### Cell 5


Since the First Peak of Cell5 is not monosynaptic, we are going to only compare values of Total_Area of the cell’s response after the stimulations.


```{r message=FALSE, warning=FALSE, include = FALSE}
cell5 <- read_csv("../Data/Project - Cell5.csv")
```

<a href="javascript:showhide('datatablecellcell5')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatablecellcell5" style="display:none;">


The data was not split into sections because the 20% rule in Ra was satisfied. Note, you can hover over the dots and see the exact values of Ra and Total Areas.



```{r message=FALSE, warning=FALSE}
plot_ly(cell5,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area, "\n"), colors=c("skyblue","yellow", "orange")) %>%

     layout(
       title = 'Change in Ra since time in Cell2',
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```




Below is the five-number summary of the above graph:

```{r}

pander(favstats(cell5$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 1-26", split.table=Inf)
```


From here we can see that the difference between the minimum and maximum values of Ra is 14.4% (<20%), which means we can proceed with comparing “monochromator” and “control” for this data.


----


</div>



**Total Area Response:**



Below is the boxplot comparison of the data gathered from Cell5 for the 'Total_Area' column: 

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell5, col=c("skyblue","orange"), main = "Lamina I Cell5 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```



```{r}
cell5 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell5", split.table=Inf)
```


<a href="javascript:showhide('thevelast')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="thevelast" style="display:none;">

Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell5$Total_Area[cell5$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell5$Total_Area[cell5$Stimulation_Type == "monochromator"], main = "QQ-plot of monochromator", ylab="Total_Area", id=FALSE)
```


The requirements are satisfied, so we can proceed with performing the Independent Samples t-Test. Here are the results:


</div>


```{r, include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell5))
```




| Test statistic |   df   |    P value  |    Alternative hypothesis |
|:----------------:|-------|--------------|------------------------|
|     -2.677       |   22.95  |   0.01349 *   |  two.sided       | 


Table: Welch Two Sample t-test: Total_Area Cell5 of ‘control’ and ‘monochromator’

P-value is significant (0.01349<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that when the axons of RVM are stimulated with monochromator the overall cell's response is different.

From this data, on average in the excitatory cell, monochromator decreases the negative response from -1865 to -1568 which is **15.9%**.



#### Lazer vs Control {.tabset .tabset-fade}



Since we are interested in knowing if there is a difference in the response of the spinal cord cells after electrical stimulation of dorsal root with and without simultaneous RVM axons stimulation by laser, our null and alternative hypotheses for all 3 cells are as follows (note, "laser" was used only on the first 3 cells. The last two cells only had "monochromator" and "control" used as 'Stimulation_Types'):

$$
  H_0: \mu_{control} = \mu_{laser}
$$

$$ 
  H_a: \mu_{control} \neq \mu_{laser}
$$
where,

$\mu_{control}$ is the mean Total_Area (in $pA*ms$)/First_Peak (in $pA$) of the patched cell's response after the axons of RVM were electrically stimulated (in pA*ms); 

$\mu_{laser}$ is the mean Total_Area (in $pA*ms$)/First_Peak (in $pA$) of the patched cell's response after the axons of RVM were simultaneously stimulated electrically and with a laser.

The level of significance is set at $\alpha$ = 0.05 for this study.




##### Cell 1

Since the First Peak of Cell1 is not monosynaptic, we are going to only compare values of Total_Area of the cell’s response after the stimulations.

```{r, include=FALSE}
cell1 <- read_csv("../Data/Project - Cell1.csv")
```

<a href="javascript:showhide('datatable7')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatable7" style="display:none;">


To avoid an increase in the Familywise Error Rate (the probability of committing at least one Type I Error amongst two or more statistical analyses on the same sample of data), we are not going to use the same data we have already used in the 'Monochromator vs Control' portion of the analysis. So, since we have already used some segments where "monochromator" and "control" were performed, we will only focus on the unused portion in the middle of the plot. 

Since we can only compare those portions of the data where the Ra is approximately the same for all of the data points, all of the Ra values for each ‘Stimulation_Type’ were compared and filtered to achieve that rule using 20% as a cut off (or maximum percentage) of Ra deviation. Note that since the Ra for the laser was not known, there are white spaces where the laser was used for stimulation.  Even though we do not know the exact values of Ra when the laser was used, chances are it follows a line connecting the monochromator results or the control right at the beginning or at the end where laser stimulation was performed. So, for this portion of the analysis, I used the very last connecting data points as the maximum or the minimum Ra of the laser (assuming laser Ra did not go pass those minimum and maximum values) to have at least some insight into if the laser and control groups produce different responses. Because the exact Ra’s of the laser was not known, we will have to take the results of the laser group with a grain of salt. However, still, most likely the data was filtered correctly and the results are valid.

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra withing the 20% difference and was used for getting the ANOVA test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out.

Note, you can hover over the dots and see the exact values of Ra and Total Area.
```{r message=FALSE, warning=FALSE}
plot_ly(cell1,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(list(type='line', x0= 28, x1= 28, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 61, x1= 61, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 0, x1 = 28, xref = "x",
                    y0 = 0, y1 = 50, yref = "y"),
             list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 61, x1 = 86, xref = "x",
                    y0 = 0, y1 = 50, yref = "y")),
       title = "Change in Ra since time in Cell1",
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```


Below is the five-number summary of the region of the graph that was not yet used for other tests taking the very last Ra of monochromator to the left of the dashed lines (Order=23) as a starting point and the very first Ra of the control to the right of the dashed lines (Order 62) as the ending point:

```{r}
cell1Filterl<-filter(cell1, Order > 22 & Order < 63)
pander(favstats(cell1Filterl$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 23-62", split.table=Inf)
```



From here we can see that the difference between the minimum and maximum values of Ra is 24.0% (>20%). Thus, I decided to eliminate some of the laser points to the left of the dashed line moving it to Order = 28.


```{r}
cell1Filterlt<-filter(cell1, Order > 27 & Order < 63)
pander(favstats(cell1Filterlt$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 28 - 62", split.table=Inf)
```

If we assume that the smallest Ra value is at the right dashed line (Ra = 34.09) the difference between min and max Ra is 19.5% (<20%). So now we will filter out the very last point (Order=62) to not use it twice (we used it when we were comparing the monochromator vs control). So now we can proceed with comparing “laser” and “control” for this segment of data.

```{r, include=FALSE}
cell1Filterl1<-filter(cell1, Order > 27 & Order < 62)
pander(favstats(cell1Filterl1$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 28 - 61", split.table=Inf)
```



----




</div>




**Total Area Response:**



Below is the boxplot comparison of the data segment with laser vs control gathered in Cell1 for the 'Total_Area' column. The gray color indicates non-significance of the p-value for the below boxplots.

```{r}
boxplot(Total_Area~Stimulation_Type, data = cell1Filterl1, col=c("gray58","gray82"), main = "Lamina I Cell1 Inhibitory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell1Filterl1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), sd =sd(Total_Area), 'sample size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell1", split.table=Inf)
```


<a href="javascript:showhide('onemore')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="onemore" style="display:none;">


Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell1Filterl1$Total_Area[cell1Filterl1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell1Filterl1$Total_Area[cell1Filterl1$Stimulation_Type == "laser"], main = "QQ-plot of laser", ylab="Total_Area", id=FALSE)
```


There seems to be a question about the normality of "laser" data (n=22), so we will use Permutation Test (which allows for any test whether the data is parametric or not). Here are the results that we get:



```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell1Filterl1, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell1Filterl1$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell1Filterl1, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats >= observedTestStat)/N
```


</div>


```{r include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell1Filterl1), split.table=Inf)
```


|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|------------------------|------------------------|
|   1.017      |  0.317     | 2000  |  two.sided       | 


Table: Permutation Test of Total_Area Cell1 of ‘control’ and ‘laser’ 



P-value is not significant (0.317>$\alpha$), so we fail to reject the null. This means that there is no significant evidence to conclude that when the axons of RVM are stimulated with laser the overall cell's response is different than that from the control. 




##### Cell 2


Since the First Peak of Cell2 is monosynaptic, we are going to compare both the Total_Area and the First_Peak amplitude of the cell’s response after the stimulation.



```{r message=FALSE, warning=FALSE, include = FALSE}
cell2 <- read_csv("../Data/Project - Cell2.csv")
```


<a href="javascript:showhide('datatable6')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatable6" style="display:none;">


To avoid an increase in the Familywise Error Rate (the probability of committing at least one Type I Error amongst two or more statistical analyses on the same sample of data), we are not going to use the same data we have already used in the ‘Monochromator vs Control’ portion of the analysis. So, since we have already used some segments where “monochromator” and “control” were performed, we will only focus on the unused portion in the middle of the plot.

Since we can only compare those portions of the data where the Ra is approximately the same for all of the data points, all of the Ra values for each ‘Stimulation_Type’ were compared and filtered to achieve that rule using 20% as a cut off (or maximum percentage) of Ra deviation. Note that since the Ra for the laser was not known, there are white spaces where the laser was used for stimulation. Even though we do not know the exact values of Ra when the laser was used, chances are it follows a line connecting the monochromator results or the control right at the beginning or at the end where laser stimulation was performed. So, for this portion of the analysis, I used the very last connecting data points as the maximum or the minimum Ra of the laser (assuming laser Ra did not go pass those minimum and maximum values) to have at least some insight into if the laser and control groups produce different responses. Because the exact Ra’s of the laser was not known, we will have to take the results of the laser group with a grain of salt. However, still, most likely the data was filtered correctly and the results are valid.

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra withing the 20% difference and was used for getting the ANOVA test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out.

Note, you can hover over the dots and see the exact values of Ra and Total Area.


```{r message=FALSE, warning=FALSE}
plot_ly(cell2,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area, "\n", "First_Peak:", First_Peak), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(list(type='line', x0= 21.7, x1= 21.7, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 9, x1= 9, y0=0, y1=50, line=list(dash='dot', width=2)),
                        list(type='line', x0= 0, x1= 101, y0= 33.93792, y1= 33.93792, line=list(dash='line', width=1, color = "red")),
                        list(type='line', x0= 22, x1= 22, y0=0, y1=50, line=list(dash='line', width=1, color = "red")),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 =22, x1 = 101, xref = "x",
                    y0 = 0, y1 = 50, yref = "y"),
                    list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 =0, x1 = 9, xref = "x",
                    y0 = 0, y1 = 50, yref = "y")),
       title = 'Change in Ra since time in Cell2',
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```



Below is the five-number summary of the region of the graph that was not yet used for other tests taking the very last Ra of control to the left of the first dashed line (Order=42) as the ending point(or the max) of Ra of laser:


```{r}
cell2Filterl<-filter(cell2, Order < 43)
pander(favstats(cell2Filterl$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 0-42", split.table=Inf)
```



From here we can see that the difference between the minimum and maximum values of Ra is 75.7% (>20%). Thus, we need to filter the data further. 

The most obvious way is filtering out the tails and compare only the data points that have "laser" and "control" close to each other. If we take Order = 9 (Ra=28.2816) as a starting point, then the endpoint has to be no greater than 33.94 for the 20% rule not to be violated. If we draw a horizontal line in red at 33.94 and vertical line through it where we would imagine the line of the Ra to go if laser's Ra was known, we will get the Order = 22 as the ending point. So, assuming that this data segment ('Order' is 9-22) has Ra within 20% difference we will proceed with the test. 

```{r}
cell2Filterl1<-filter(cell2, Order > 8 & Order < 23)
```

----



</div>







<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'FirstPeakResponse13')">First Peak Response</button>
  <button class="tablinks" onclick="openTab(event, 'TotalAreaResponse13')">Total Area Response</button>
</div>

<div id="FirstPeakResponse13" class="tabcontent" style="display:block;">
  <p>
  
  
  
  **First Peak Response:**


Below is the boxplot comparison of the chosen data segment gathered in Cell2 for "laser" vs "control" the 'First_Peak' column. The gray color indicates a non-significance of the p-value for the below boxplots.

```{r}
boxplot(First_Peak~Stimulation_Type, data = cell2Filterl1, col=c("gray58","gray82"), main = "Lamina I Cell2 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="First Peak Amplitude of Mosynaptic Response (pA)")
```


```{r}
 cell2Filterl1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample size'=n()) %>% pander(caption="Summary Statistics of First Peak Amplitude Cell2", split.table=Inf)
```


<a href="javascript:showhide('show')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="show" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell2Filterl1$First_Peak[cell2Filterl1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="First_Peak", id=FALSE)
qqPlot(cell2Filterl1$First_Peak[cell2Filterl1$Stimulation_Type == "laser"], main = "QQ-plot of laser", ylab="First_Peak", id=FALSE)
```



Both of the samples have a normal distribution, so we can proceed with performing the Independent Samples t-Test:


</div>



```{r, include=FALSE}
pander(t.test(First_Peak~Stimulation_Type, data = cell2Filterl1), split.table=Inf)
```




| Test statistic |   df   |    P value  |    Alternative hypothesis |
|:----------------:|-------|--------------|------------------------|
|    -0.1156      |   11.53   |  0.91   |  two.sided       | 



Table: Welch Two Sample t-test: First_Peak Cell2 of ‘control’ and ‘laser’


P-value is not significant (0.91>$\alpha$), so we fail to reject the null. This means that there is insignificant evidence to conclude that when the laser was used the overall cell's response was different.



  
  </p>
</div>


<div id="TotalAreaResponse13" class="tabcontent" style="display:block;">
  <p>

**Total Area Response:**


Below is the boxplot comparison of our data segment gathered in Cell2 for the 'Total_Area' column. The gray color indicates non-significance of the p-value for the below boxplots.


```{r}
boxplot(Total_Area~Stimulation_Type, data = cell2Filterl1, col=c("gray58","gray82"), main = "Lamina I Cell2 Excitatory  Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell2Filterl1 %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'Sample Size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell2", split.table=Inf)
```

<a href="javascript:showhide('more33')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="more33" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:

```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell2Filterl1$Total_Area[cell2Filterl1$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell2Filterl1$Total_Area[cell2Filterl1$Stimulation_Type == "laser"], main = "QQ-plot of laser", ylab="Total_Area", id=FALSE)
```


The laser sample seems to satisfy the requirements, however, the control group is questionable, so we are going to use Permutations Test (which allows for any test whether it is parametric or not). Here are the results that we get:

```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell2Filterl1, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell2Filterl1$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell2Filterl1, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>


```{r, include=FALSE}
pander(t.test(Total_Area~Stimulation_Type, data = cell2Filterl1), split.table=Inf)
```


|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|------------------------|------------------------|
|  -0.4919      | 0.622     | 2000  |  two.sided       | 


Table: Permutation Test of Total_Area Cell2 of ‘control’ and ‘laser’


P-value is not significant (0.622>$\alpha$), so we fail to reject the null. This means that there is insignificant evidence to conclude that when the axons of RVM are stimulated with laser the overall cell’s response is different.



 </p>
</div>



##### Cell 3


Since the First Peak of Cell3 is monosynaptic, we are going to compare both the Total_Area and the First_Peak amplitude of the cell’s response after the stimulation.

```{r message=FALSE, warning=FALSE, include = FALSE}
cell3 <- read_csv("../Data/Project - Cell3.csv")
```


<a href="javascript:showhide('datatablecekk')">Show how the data was filtered <span style="font-size:8pt;">(click to view)</span></a>

<div id="datatablecekk" style="display:none;">



To avoid an increase in the Familywise Error Rate (the probability of committing at least one Type I Error amongst two or more statistical analyses on the same sample of data), we are not going to use the same data we have already used in the ‘Monochromator vs Control’ portion of the analysis. So, since we have already used some segments where “monochromator” and “control” were performed, we will only focus on the unused portion in the middle of the plot.

Since we can only compare those portions of the data where the Ra is approximately the same for all of the data points, all of the Ra values for each ‘Stimulation_Type’ were compared and filtered to achieve that rule using 20% as a cut off (or maximum percentage) of Ra deviation. Note that since the Ra for the laser was not known, there are white spaces where the laser was used for stimulation. Even though we do not know the exact values of Ra when the laser was used, chances are it follows a line connecting the monochromator results or the control right at the beginning or at the end where laser stimulation was performed. So, for this portion of the analysis, I used the very last connecting data points as the maximum or the minimum Ra of the laser (assuming laser Ra did not go pass those minimum and maximum values) to have at least some insight into if the laser and control groups produce different responses. Because the exact Ra’s of the laser was not known, we will have to take the results of the laser group with a grain of salt. However, still, most likely the data was filtered correctly and the results are valid.

So, in the graph below the area that is colored in grey indicates the data that was not considered for this portion of the analysis. In other words, the area that is not highlighted in grey had Ra withing the 20% difference and was used for getting the ANOVA test results. The vertical dashed lines indicate the exact place where the data was split; anything beyond those lines was filtered out.

Note, you can hover over the dots and see the exact values of Ra and Total Area.



```{r message=FALSE, warning=FALSE}
plot_ly(cell3,  x=~Order, y=~Ra, size=~100, color=~as.factor(Stimulation_Type), text= ~paste("Ra:", Ra, "\n", "Total_Area:", Total_Area, "\n", "First_Peak:", First_Peak), colors=c("skyblue","yellow", "orange")) %>%

     layout(shapes=list(
                        list(type='line', x0= 32, x1= 32, y0=0, y1=62, line=list(dash='dot', width=2)),
                        list(type='line', x0= 64, x1= 64, y0=0, y1=62, line=list(dash='dot', width=2)),
                        list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 64, x1 = 95, xref = "x",
                    y0 = 0, y1 = 62, yref = "y"),
                    list(type = "rect",
                    fillcolor = "grey", line = list(color = "grey"), opacity = 0.3,
                    x0 = 0, x1 = 32, xref = "x",
                    y0 = 0, y1 = 62, yref = "y")),
       title = 'Change in Ra since time in Cell3',
       xaxis = list(title = "Order in which the data was recorded", showgrid = TRUE),
       yaxis = list(title = "Ra(M[omega])", showgrid = TRUE))

```



Below is the five-number summary of the region of the graph that was not yet used for other tests and plus the very last Ra of control to the left (Order=52) as the starting point(or the min) of Ra of laser and the max Ra of the laser of 57.57 (Ra of the control group to the right, Order = 64):


```{r}
cell3Filterlb<-filter(cell3, Order > 32 & Order < 65)
pander(favstats(cell3Filterlb$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 33-64", split.table=Inf)
```


From here we can see that the difference between the minimum and maximum values of Ra is 17.6% (<20%). So now we will filter out the very last point (Order=64) to not use it twice (we used it when we were comparing the monochromator vs control). So now we can proceed with comparing “laser” and “control” for this segment of data (Order is 33-63).

```{r}
cell3Filterl<-filter(cell3, Order > 32 & Order < 64)
pander(favstats(cell3Filterl$Ra)[,-9],caption="Summary Statistics of Ra when 'Order' is 33-63", split.table=Inf)
```

----



</div>






<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'FirstPeakResponsecev')">First Peak Response</button>
  <button class="tablinks" onclick="openTab(event, 'TotalAreaResponsecev')">Total Area Response</button>
</div>

<div id="FirstPeakResponsecev" class="tabcontent" style="display:block;">
  <p>
  
  
  
**First Peak Response:**
  

Below is the boxplot comparison of the chosen data segment [click on ‘Show how the data was filtered’ for more information on that] of the data gathered in Cell3 for the ‘First_Peak’ column. 

```{r}
boxplot(First_Peak~Stimulation_Type, data = cell3Filterl, col=c("skyblue","yellow"), main = "Lamina I Cell3 Excitatory Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="First Peak of Mosynaptic Response (pA)")
```


```{r}
cell3Filterl %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(First_Peak), Q1 = quantile(First_Peak, 0.25), med = median(First_Peak), Q3 = quantile(First_Peak, 0.75), max = max(First_Peak), mean=mean(First_Peak), 'sd'=sd(First_Peak), 'sample size'=n()) %>% pander(caption="Summary Statistics of First Peak Amplitude Cell2 First Data Segment", split.table=Inf)
```


<a href="javascript:showhide('yes')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="yes" style="display:none;">

Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell3Filterl$First_Peak[cell3Filterl$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="First_Peak", id=FALSE)
qqPlot(cell3Filterl$First_Peak[cell3Filterl$Stimulation_Type == "laser"], main = "QQ-plot of laser", ylab="First_Peak", id=FALSE)
```


Since neither of the samples has a normal distribution and small sample sizes, we cannot proceed with performing the Independent Samples t-Test. So, instead, we are going to use Permutations Test (which allows for any test whether it is parametric or not). Here are the results that we get:

```{r}
myTest<-t.test(First_Peak~Stimulation_Type, data = cell3Filterl, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell3Filterl$Stimulation_Type)
  permutedTest <- t.test(First_Peak ~ permutedData, data = cell3Filterl, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```



</div>


```{r, include=FALSE}
pander(t.test(First_Peak~Stimulation_Type, data = cell3Filterl ), split.table=Inf)
```


|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|------------------------|------------------------|
|  -4.086      | 0.002    | 2000  |  two.sided       | 


Table: Permutation Test of First_Peak Cell3 First Data Segment of ‘control’ and ‘laser’ 


P-value is significant (0.002<$\alpha$), so we reject the null. This means that there is significant evidence to conclude that when the laser was used the overall cell’s response was different.


  
  </p>
</div>


<div id="TotalAreaResponsecev" class="tabcontent" style="display:block;">
  <p>

**Total Area Response:**


Below is the boxplot comparison of our data segment gathered in Cell3 for the ‘Total_Area’ column. The gray color indicates non-significance of the p-value for the below boxplots.


```{r}
boxplot(Total_Area~Stimulation_Type, data = cell3Filterl , col=c("gray58","gray82"), main = "Lamina I Cell3 Excitatory  Currents Comparison in mouse#2", xlab ="Stimulation Type of RVM Descending Fibers", ylab="Total Area of the Cell's Response (pA*ms)")
```


```{r}
cell3Filterl  %>%
group_by(Stimulation_Type) %>%
  summarise(min = min(Total_Area), Q1 = quantile(Total_Area, 0.25), med = median(Total_Area), Q3 = quantile(Total_Area, 0.75), max = max(Total_Area), mean=mean(Total_Area), 'sd'=sd(Total_Area), 'sample Size'=n()) %>% pander(caption="Summary Statistics of Total_Area Cell3", split.table=Inf)
```


<a href="javascript:showhide('before')">Show the diagnostic plots<span style="font-size:8pt;">(click to view)</span></a>

<div id="before" style="display:none;">



Before performing the Independent Samples t Test, let’s first see if the requirements for this test are satisfied:


```{r message=FALSE, warning=FALSE}
par(mfrow=c(1,2))
qqPlot(cell3Filterl$Total_Area[cell3Filterl$Stimulation_Type == "control"], main = "QQ-plot of control", ylab="Total_Area", id=FALSE)
qqPlot(cell3Filterl$Total_Area[cell3Filterl$Stimulation_Type == "laser"], main = "QQ-plot of laser", ylab="Total_Area", id=FALSE)
```


The laser sample seems to somewhat satisfy the requirement of a normal distribution, however, the control group does not, so we cannot proceed with performing the Independent Samples t-Test. So, instead, we are going to use Permutations Test (which allows for any test whether it is parametric or not). Here are the results that we get:

```{r}
myTest<-t.test(Total_Area~Stimulation_Type, data = cell3Filterl, mu = 0)
observedTestStat <- myTest$statistic

N <- 2000
permutedTestStats <- rep(NA, N)
for (i in 1:N){
  permutedData <- sample(cell3Filterl$Stimulation_Type)
  permutedTest <- t.test(Total_Area ~ permutedData, data = cell3Filterl, mu = 0)
  permutedTestStats[i] <- permutedTest$statistic
}

hist(permutedTestStats, col = "skyblue")
abline(v = observedTestStat, col = "red", lwd = 3)
```

```{r, include=FALSE}
2*sum(permutedTestStats <= observedTestStat)/N
```


</div>


```{r, include=FALSE}

pander(t.test(Total_Area~Stimulation_Type, data = cell3Filterl ), split.table=Inf)
```


|  Test statistic  | P value  | Number of Iterations | Alternative hypothesis |
|:---------:| ---------|------------------------|------------------------|
|  -0.502      | 0.615    | 2000  |  two.sided       | 


Table: Permutation Test of Total_Area Cell3 First Data Segment of ‘control’ and ‘laser’ 



P-value is not significant (0.615>$\alpha$), so we fail to reject the null. This means that there is insignificant evidence to conclude that when the axons of RVM are stimulated with laser the overall cell’s response is different.



 </p>
</div>





## Conclusion


"Laser" stimulation type has consistently given us non-significant results, except for just one significant result in Cell3 for the First_Peak response for just one data segment. It has also given us results without any distinct patterns, which simply means laser does not work and does not activate RVM descending fibers.

The fact that 10 out of 15 tests that we performed on monochromator data gave us significant results and that in all 15 tests and all the different data segments monochromator behaved the same way - inhibiting both the excitatory and inhibitory exits from the dorsal root stimulation, we can conclude that monochromator was effective in changing (inhibiting) lamina I cells' responses after the dorsal root stimulation. From all the data on the monochromator we could see that on average First_Peak response was inhibited by **12.4%** and the Total_Area was inhibited by an average of **19.1%**.

If our assumption of monochromator activating only RVM descending fibers proves to be correct (with the negative control), then the exact connectivity pattern of the cells that were patched in lamina I and the RVM descending axons most likely looks like this:


<br/>
<center>
<img src="../Data/AxonConnectivity.PNG" style="width:1000px;border:2px white;border-radius:5px;">
</center>
<br/>



[^1]: [American Society of Regional Anesthesia and Pain Medicine](https://www.asra.com/page/45/types-of-chronic-pain)


[^2]: [Watkins EA, Wollan PC, Melton LJ 3rd, Yawn BP. A population in pain: report from the Olmsted County health study. Pain Med 2008; 9:166.](https://www.uptodate.com/contents/use-of-opioids-in-the-management-of-chronic-non-cancer-pain/abstract/1)

[^3]: [Kuehn B. Chronic Pain Prevalence. JAMA. 2018;320(16):1632. doi:10.1001/jama.2018.16009](https://jamanetwork.com/journals/jama/article-abstract/2708128)

[^4]: [University of Washington Health Sciences/UW Medicine. (2018, May 4)](https://www.sciencedaily.com/releases/2018/05/180504103804.htm)


[^5]: [Nachum Dafny, Ph.D., Department of Neurobiology and Anatomy, McGovern Medical School](https://nba.uth.tmc.edu/neuroscience/m/s2/chapter07.html)

[^6]: [Ossipov, M. H., Dussor, G. O., & Porreca, F. (2010). Central modulation of pain. The Journal of clinical investigation, 120(11), 3779–3787](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2964993/)

[^7]: [Hossaini, M., Goos, J. A., Kohli, S. K., & Holstege, J. C. (2012). Distribution of glycine/GABA neurons in the ventromedial medulla with descending spinal projections and evidence for an ascending glycine/GABA projection. PloS one, 7(4), e35293](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3340372/)

[^8]: [Einar Ottestad, Martin S. Angst, in Pharmacology and Physiology for Anesthesia, 2013](https://www.sciencedirect.com/science/article/pii/B9781437716795000144)

[^9]: [Basbaum AI, Bráz JM. Transgenic Mouse Models for the Tracing of “Pain” Pathways. In: Translational Pain Research: From Mouse to Man. CRC Press/Taylor & Francis, Boca Raton, FL; 2010](https://europepmc.org/article/NBK/NBK57274)